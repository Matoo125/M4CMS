{% include 'Base.twig' %}


{% block body %}
<!--content area start-->
<div id="content" class="pmd-content inner-page">

  <!--tab start-->
  <div class="container-fluid full-width-container">
  
    <!-- Title -->
    <h1 class="section-title" id="services">
      <span>Create new Page</span>
    </h1><!-- End Title -->
      
    <!--breadcrum start-->
    <ol class="breadcrumb text-left">
      <li><a href="/admin/pages">Pages</a></li>
      <li class="active">Create</li>
    </ol><!--breadcrum end-->
  
    {% include 'Pages/Form.twig' %}
 
      
  </div><!-- tab end -->
  
</div><!-- content area end -->


{% endblock %}

{% block script %}
<script>
var toolbar = [
  [{ 'header': [1, 2, 3, 4, 5, 6, false] }],

  ['bold', 'italic', 'underline', 'strike'], 
  ['blockquote', 'code-block'],

  [{ 'align': [] }],
  ['link', 'image'],
  ['clean']
]
  var quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
      toolbar: {
        container: toolbar,
        handlers: {
          image: imageHandler
        }
      }
    }
  });


  

  function imageHandler () {
      imageSelector.modal(function (data) {
        var range = this.quill.getSelection()
        var img = '/public/uploads/' + data.filename
        this.quill.insertEmbed(range.index, 'image', img, Quill.sources.USER)
    })
    /*
    var range = this.quill.getSelection()
    var value = prompt('What is image url')
    this.quill.insertEmbed(range.index, 'image', value, Quill.sources.USER);*/
  }

  $("form .submit").click(function () {
    formData = {
      title: $("input[name=title]").val(),
      description: $("textarea[name=description").val(),
      content: quill.root.innerHTML,
      image_id: document.querySelector('#headerImage input').value,
      is_published: $("input[name=is_published]").is(':checked')
    }
    console.log(formData)
    $.ajax({
      type: 'post',
      url: '/admin/pages/createAjax',
      data: formData
    }).done(function (response) {
     //toastr.success('Page was created')
      window.location = '/admin/pages/update/' + response.id
      console.log(response)
    }).fail(function (xhr, err) {
      console.log(err)
      console.log(xhr.responseJSON)
      toastr.error(xhr.responseJSON.message)
    })
  })



</script>
{% endblock %}